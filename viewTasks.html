<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="robots" content="Add, follow">
        <meta name="description" content="Chronify is a task management system software. Add new tasks here.">
        <meta name="keywords" content="task management, task, management, Chronify, organization, productivity">
        <meta name="author" content="Radib Bin Kabir">
        <meta name="application-name" content="Chronify">
        <meta name="theme-color" content="#f8f4ff">
        <meta name="msapplication-navbutton-color" content="#f8f4ff">
        <meta name="apple-mobile-web-app-status-bar-style" content="#f8f4ff">
        <meta property="og:title" content="Chronify - Task Management System">
        <meta property="og:description" content="Chronify is a task management system software. It helps you to organize your tasks and increase your productivity.">
        <meta property="og:url" content="https://chronify-rbk.cyclic.app/viewTasks">
        <meta property="og:site_name" content="Chronify">
        <title>Chronify - Add Tasks</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
        <link rel="stylesheet" href="./view.css">
        <link rel="canonical" href="https://chronify-rbk.cyclic.app">
        <link rel="icon" href="data:image/png;base64,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" alt="flavicon" type="image/png">
        <script type="application/ld+json">
            {
                "@context": "http://schema.org",
                "@type": "SoftwareApplication",
                "name": "ChroniFy",
                "description": "A task management system software",
                "applicationCategory": "Productivity",
                "operatingSystem": "Cross-platform",
                "url": "https://chronify-rbk.cyclic.app/viewTasks",
                "keywords": "task management, organization, productivity"
            }
        </script>   
    </head>
<body>
    <h1>CREATE NEW TASKS</h1>
    <h2 id="userinfo">Hello</h2>
    <form onsubmit="createNewTask(event)" method="POST">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" required>

        <label for="description">Description:</label>
        <textarea id="description" name="description" required></textarea>

        <label for="dueDate">Due Date:</label>
        <input type="date" id="dueDate" name="dueDate" required>

        <label for="category">Category:</label>
        <input type="text" id="category" name="category">
        <label for="priority">Priority:</label>
        <select id="priority" name="priority">
            <option value="3">Low</option>
            <option value="2">Medium</option>
            <option value="1">High</option>
        </select>
        <div style="display: flex; justify-content: space-between;">
            <button type="submit">Create New Task</button>
            <button id="nextButton">View All Tasks</button>
        </div>
    </form>
    <br>
    <script>
        
        var userInfo = {};
        window.onload = async function () {
            const token = localStorage.getItem("token");
        
            if (!token) {
                window.location.href = "/login";
            }
        
            try {
                userInfo = await fetch('/user', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `${token}`,
                    },
                }).then(response => response.json());        
                // Handle the user information
                document.getElementById('userinfo').innerHTML = userInfo.username;
                console.log(userInfo);
            } catch (error) {
                console.error('User information fetch error:', error);
                // Handle the error as needed
            }
        };
        
        function formatCategory(rawCategory) {
            return rawCategory.charAt(0).toUpperCase() + rawCategory.slice(1).toLowerCase();
        }

        async function createNewTask(event) {
            event.preventDefault();
            const form = event.target;
            form.reportValidity();
            if (!form.checkValidity()) {
                return;
            }
        
            const token = localStorage.getItem("token");
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const dueDate = document.getElementById('dueDate').value;
            const priority = document.getElementById('priority').value;
            const category = formatCategory(document.getElementById('category').value);
        
            try {
                const userId = userInfo.userId;
                console.log('User ID:', userId);
        
                if (!userId) {
                    console.error('User ID not found in user information:', userInfo);
                    throw new Error('User ID not found');
                }
        
                const response = await fetch('/tasks/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `${token}`,
                    },
                    body: JSON.stringify({
                        title: title,
                        description: description,
                        dueDate: dueDate,
                        priority: priority,
                        category: category,
                        user: userId,
                    }),
                });
        
                console.log('Response Status:', response.status);
        
                if (response.ok) {
                    alert('Task created successfully');
                    window.location.reload();
                } else {
                    const errorData = await response.json();
                    console.error('Server error:', errorData);
                    throw new Error('Task creation failed');
                }
            } catch (error) {
                console.error('Task creation error:', error);
            }
        }        
        
        document.getElementById('nextButton').addEventListener('click', function () {
            window.location.href = '/';
        });
                
    </script>
</body>
</html>
